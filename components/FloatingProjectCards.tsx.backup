'use client'

import { useEffect, useState, useRef } from 'react'


const projects = [
 {
      title:"WIP - projectpartnership",
      description: "State site design for an energy cooperative based in Aberdeen. Built in React with pure CSS and Javascript.",
      imageUrl: "/pp.png",
      ghLink: "https://github.com/yourusername/projectpartnership",
      url: "https://projectpartnership.netlify.app/",
    },
     {
      title: "CapCheck",
      description: "From the final group project on the Northcoders' bootcamp, CapCheck is a comprehensive mushroom identification app featuring an interactive map with real-time sighting locations, rainfall overlays, and searchable species markers, plus a database of over 250 mushrooms with advanced filtering by edibility and season. The app includes personalized user profiles with photo uploads, discovery tracking, and achievement systems, all built with a mobile-first design supporting both iOS and Android platforms.",
      description2:"CapCheck is built with React Native and Expo for cross-platform mobile development, featuring TypeScript, React Navigation, and React Native Maps with Google Maps integration for interactive mapping functionality. The backend utilizes FastAPI with Python for the API layer, PostgreSQL for data storage, and integrates external services like OpenWeatherMap for weather overlays, all hosted on the Render cloud platform.",
      imageUrl: "/capcheck.png",
      ghLink: "https://github.com/yourusername/projectpartnership",
      isModal: true,
      videoUrl: "https://0eswuvlc9p7jubst.public.blob.vercel-storage.com/CapCheck-Demo-fUHd6hUvzVbCJAKTX83ClzFKjzk7mK.mp4" 
    },
     {
      title: "Duologue: poetry slot machine",
      description: "A  poetry fruit machine that produces unique alignments and word patterns from the long poem \Duologue\. Using react and pure CSS to create a simple slot machine experience and random phrase generator, based on one of my poems. All logic in JS and CSS, no backend.",
      imageUrl: "/duologue.png",
      ghLink: "https://github.com/yourusername/projectpartnership",
      url: "https://duologue-slot-machine.netlify.app/"
    },
    {
      title: "Tic-Tac-Toe",
      description: "A basic two-player Tic-Tac-Toe game built with React and CSS, desktop-only. The game features a simple and intuitive interface, allowing players to take turns marking their spaces on a 3x3 grid. It's built with canvas for rendering and includes basic game logic to determine the winner or a draw.",
      imageUrl: "/ttt.png",
      ghLink: "https://github.com/yourusername/projectpartnership",
      url: "https://nought.netlify.app/"
    },
    {
      title: "Planet of the Day",
      description: "A React application that displays a new planet every day from NASA's API, showcasing the beauty of our solar system through a modal info page. The app features a clean and responsive design, allowing users to explore, on different days, various planets with detailed information and images, randomly selected from Nasa's API.",
      imageUrl: "/potd.png",
      ghLink: "https://github.com/yourusername/projectpartnership",
      url: "https://planetoftheday.netlify.app/"
    },
    {
      title: "Nc News App",
      description: "A solo project from the Northcoder's bootcampA full-stack news application built with React and Node.js, featuring user authentication, article creation, and commenting. My first experience with a full-stack application using react, constructing APIs to a database hosted on Render, and deploying a React frontend to Netlify.",
      imageUrl: "/nc-news.png",
      ghLink: "https://github.com/yourusername/projectpartnership",
      url: "https://ncnews-t0mmy-pearson.netlify.app/"
    },
    {
      title: "A Quick To-Do list",
      description: "React application that allows users to create, manage, and track their tasks. Quick and easy to use. A tutorial completed during the Northcoders bootcamp, this app features a simple and intuitive interface for task management, allowing users to add, edit, and delete tasks with ease. It includes basic functionality such as task completion tracking and local storage for persistence.",
      imageUrl: "/Tdl.png",
      ghLink: "https://github.com/yourusername/projectpartnership",
      url: "https://yourquicktodolist.netlify.app/"
    }
]

interface FloatingCard {
  id: number
  project: typeof projects[0]
  x: number
  y: number
  animationDelay: number
  floatDelay: number
}

interface FloatingProjectCardsProps {
  isTriggered?: boolean
  onTrigger?: () => void
}

const FloatingProjectCards = ({ isTriggered = false, onTrigger }: FloatingProjectCardsProps) => {
  const [cards, setCards] = useState<FloatingCard[]>([])
  const [isVisible, setIsVisible] = useState(false)
  const [selectedProject, setSelectedProject] = useState<typeof projects[0] | null>(null)
  const [isModalOpen, setIsModalOpen] = useState(false)
  const [isMobile, setIsMobile] = useState(false)

  useEffect(() => {
    // Check if device is mobile
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768)
    }
    
    checkMobile()
    window.addEventListener('resize', checkMobile)
    
    return () => window.removeEventListener('resize', checkMobile)
  }, [])

  useEffect(() => {
    if (!isTriggered) return

    const timer = setTimeout(() => {
      setIsVisible(true)
      const initialCards = projects.map((project, index) => ({
        id: index,
        project,
        x: 0,
        y: 0,
        animationDelay: index * 0.2,
        floatDelay: 0
      }))
      setCards(initialCards)
    }, 100)

    return () => clearTimeout(timer)
  }, [isTriggered])

  const handleCardClick = (card: FloatingCard) => {
    setSelectedProject(card.project)
    setIsModalOpen(true)
  }

  const closeModal = () => {
    setIsModalOpen(false)
    setSelectedProject(null)
  }

  const handleVisitProject = () => {
    if (selectedProject?.url) {
      window.open(selectedProject.url, '_blank')
    }
    closeModal()
  }

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Escape') {
      closeModal()
    }
  }

  if (!isVisible) return null

  return (
    <>
      <div className="w-full h-full bg-[#f0edcf] px-8 py-16 overflow-y-auto">
        <div className="max-w-6xl mx-auto">
          <h2 className="text-4xl font-bold mb-12 text-center libertinus-mono-regular text-gray-800">
            Full-Stack Projects
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {cards.map((card) => {
              const splatShapes = [
                '40% 60% 70% 30% / 60% 30% 70% 40%',
                '60% 40% 30% 70% / 40% 70% 60% 30%',
                '30% 70% 60% 40% / 70% 30% 40% 60%',
                '70% 30% 40% 60% / 30% 60% 70% 40%',
                '50% 30% 70% 40% / 60% 40% 30% 70%'
              ]
              
              const splatShape = splatShapes[card.id % splatShapes.length]
              
              // Reduced rotation for more stability
              const rotation = Math.random() * 20 - 10 // Between -10 and 10 degrees
              
              // Different paint colors for variety
              const paintColors = [
                '#cb4242', // Red
                '#3b82f6', // Blue  
                '#eab308', // Yellow
                '#22c55e', // Green
                '#a855f7', // Purple
                '#f97316', // Orange
                '#ec4899'  // Pink
              ]
              const paintColor = paintColors[card.id % paintColors.length]
              
              return (
                <div
                  key={card.id}
                  className="cursor-pointer opacity-0 animate-fade-in-up w-full max-w-sm mx-auto"
                  style={{
                    animationDelay: `${card.animationDelay}s`,
                    animationFillMode: 'forwards'
                  }}
                  onClick={() => handleCardClick(card)}
                >
                  <div 
                    className="relative p-4 hover:shadow-2xl transition-all duration-300 hover:scale-105"
                    style={{
                      borderRadius: splatShape,
                      transform: `rotate(${rotation}deg)`,
                      backgroundColor: paintColor,
                      opacity: 0.9
                    }}
                  >
                    {/* Paint splat drops */}
                    <div 
                      className="absolute w-3 h-3 rounded-full"
                      style={{
                        top: '-8px',
                        left: '20%',
                        borderRadius: '50% 30%',
                        backgroundColor: paintColor,
                        opacity: 0.8
                      }}
                    ></div>
                    <div 
                      className="absolute w-2 h-2 rounded-full"
                      style={{
                        bottom: '-6px',
                        right: '15%',
                        backgroundColor: paintColor,
                        opacity: 0.7
                      }}
                    ></div>
                    <div 
                      className="absolute w-4 h-2"
                      style={{
                        top: '30%',
                        right: '-10px',
                        borderRadius: '60% 40%',
                        backgroundColor: paintColor,
                        opacity: 0.6
                      }}
                    ></div>
                    <div 
                      className="absolute w-2 h-3"
                      style={{
                        bottom: '20%',
                        left: '-8px',
                        borderRadius: '40% 60%',
                        backgroundColor: paintColor,
                        opacity: 0.5
                      }}
                    ></div>
                    <div className="w-full h-32 mb-3 overflow-hidden shadow-inner relative z-10" style={{borderRadius: '30% 70% 60% 40%'}}>
                      <img 
                        src={card.project.imageUrl} 
                        alt={card.project.title}
                        className="w-full h-full object-cover transition-transform duration-300 hover:scale-110"
                        style={{borderRadius: '30% 70% 60% 40%'}}
                      />
                    </div>
                    <h3 className="text-base font-bold text-gray-900 mb-2 line-clamp-2 drop-shadow-sm relative z-10 libertinus-mono-bold">{card.project.title}</h3>
                    <p className="text-sm text-gray-700 line-clamp-3 drop-shadow-sm relative z-10 libertinus-mono-regular">{card.project.description}</p>
                  </div>
                </div>
              )
            })}
          </div>
        </div>
      </div>

      {/* Modal */}
      {isModalOpen && selectedProject && (
        <div 
          className="fixed inset-0 bg-black/50 flex items-center justify-center z-500 p-4"
          onClick={closeModal}
          onKeyDown={handleKeyDown}
          tabIndex={0}
        >
          <div 
            className="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl"
            onClick={(e) => e.stopPropagation()}
          >
            <div className="relative">
              {/* Close button */}
              <button
                onClick={closeModal}
                className="absolute top-4 right-4 z-10 hover:bg-gray-100 rounded-full p-2 shadow-lg transition-all duration-200"
              >
                <svg className="w-6 h-6" fill="none" stroke="black" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>

              {/* Project image */}
              <div className="w-full h-64 overflow-hidden rounded-t-lg">
                <img 
                  src={selectedProject.imageUrl} 
                  alt={selectedProject.title}
                  className="w-full h-full object-cover"
                />
              </div>

              {/* Project content */}
              <div className="p-6">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-2xl font-bold text-gray-900 libertinus-mono-bold">{selectedProject.title}</h2>
                  {selectedProject.ghLink && (
                    <button
                      onClick={() => window.open(selectedProject.ghLink, '_blank')}
                      className="flex-2 bg-transparent hover:bg-gray-100 text-black font-semibold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2"
                    >
                      <img 
                        src="/icons8-github-64.png" 
                        alt="GitHub" 
                        className="w-8 h-8"
                      />
                    </button>
                  )}
                </div>
                <div className="space-y-4">
                  <div>
                    <p className="text-gray-600 leading-relaxed libertinus-mono-regular">{selectedProject.description}</p>
                  </div>

                  {selectedProject.description2 && (
                    <div>
                      <h3 className="text-lg font-semibold text-gray-800 mb-2 libertinus-mono-regular">Technical Details</h3>
                      <p className="text-gray-600 leading-relaxed libertinus-mono-regular">{selectedProject.description2}</p>
                    </div>
                  )}

                  {selectedProject.videoUrl && (
                    <div>
                      <h3 className="text-lg font-semibold text-gray-800 mb-2 libertinus-mono-regular">Demo Video</h3>
                      <video 
                        controls 
                        className="w-full rounded-lg shadow-lg"
                        poster={selectedProject.imageUrl}
                      >
                        <source src={selectedProject.videoUrl} type="video/mp4" />
                        Your browser does not support the video tag.
                      </video>
                    </div>
                  )}
                </div>

                {/* Action buttons */}
                <div className="flex gap-4 mt-6">
                  {selectedProject.url && (
                    <button
                      onClick={handleVisitProject}
                      className="flex-1 bg-slate-400 hover:bg-slate-500 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 libertinus-mono-regular"
                    >
                      Visit Project
                    </button>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </>
  )
}

export default FloatingProjectCards
